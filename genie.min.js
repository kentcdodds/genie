/** 
 * genie - v0.3.0 @license
 * (c) 2014-01-03 - Kent C. Dodds <kent@doddsfamily.us>
 * A JavaScript library committed to improving user experience by empowering users to interact with web apps using the keyboard (better than cryptic shortcuts).
 * Freely distributed under the MIT license
 * https://github.com/kentcdodds/genie
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):a.genie=b()}(this,function(){"use strict";function a(c){if(_(c)){var d=[];return U(c,function(b){d.push(a(b))}),d}var e=b(c),f=m(e.id);return 0>f?xb.push(e):xb[f]=e,e}function b(a){var b=a.id||"g-"+yb++,d={id:b,context:c(a.context),data:a.data||{},magicWords:M(a.magicWords),action:e(a.action)};return d.data.timesMade={total:0,magicWords:{}},d}function c(a){var b=a||Ab;return b=ab(b)||_(b)?{any:M(b)}:d(a)}function d(a){function b(b){a[b]&&(a[b]=M(a[b]))}return b("all"),b("any"),b("none"),a}function e(a){return ab(a)&&(a={destination:a}),bb(a)?function(){a.openNewTab?window.open(a.destination,"_blank"):window.location.href=a.destination}:a}function f(a){var b=xb.indexOf(a);return b||U(xb,function(c,d){return a===c.id||a.id===c.id?(b=d,a=c,!1):void 0}),xb.splice(b,1),g(a.id),a}function g(a){function b(c,d,e){U(c,function(d,e){if("wishes"===e){var f=d.indexOf(a);-1!==f&&d.splice(f,1),d.length||delete c[e]}else b(d,c,e)});var f=s(c,"wishes").length>0;!f&&d&&e&&delete d[e]}b(zb)}function h(a,b,c){var d=j(a,b,c);return U(d,function(a,b){d[b]=f(a)}),d}function i(a){a=a||Ab;var b=[];return U(xb,function(c){(E(a)||E(c.context)||G(c,a))&&b.push(c)}),b}function j(a,b,c){var d=[];return b=b||"any",U(xb,function(e){var f=k(e,c);!T(f)&&("all"===b&&R(f,a)||"none"===b&&Q(f,a)||"any"===b&&P(f,a))&&d.push(e)}),d}function k(a,b){var c=[];return b=b||["all","any","none"],b=M(b),U(b,function(b){a.context[b]&&(c=c.concat(a.context[b]))}),c}function l(a){if(_(a)){var b=[];return U(m(a),function(a){b.push(xb[a])}),b}var c=m(a);return c>-1?xb[c]:null}function m(a){var b=-1;if(_(a)){var c=[];return U(a,function(a){c.push(m(a))}),c}return U(xb,function(c,d){return c.id===a?(b=d,!1):void 0}),b}function n(){var a=gb();return gb({wishes:[],noWishMerge:!0,previousId:0,enteredMagicWords:{},context:Ab,previousContext:Ab,enabled:!0}),a}function o(a){a=(fb(a)?"":""+a).toLowerCase();var b=p(a),c=l(b),d=q(c),e=t(xb,b,a),f=l(e);return d.concat(f)}function p(a){var b=r(zb,a.split(""));return b?s(b,"wishes",!0):[]}function q(a){var b=[];return U(a,function(a){a&&F(a)&&b.push(a)}),b}function r(a,b){var c=a;b=M(b);var d=U(b,function(a){return c.hasOwnProperty(a)?(c=c[a],!0):!1});return d?c:null}function s(a,b,c){function d(a){U(a,function(a,f){if(f===b){var g=M(a);U(g,function(a){c&&S(e,a)||e.push(a)})}else e=e.concat(d(a))})}var e=[];return d(a),e}function t(a,b,c){var d=[],e=[];return U(a,function(a){if(F(a)){var e=u(a.magicWords,c);y(a,e,d,b)}},!0),U(d,function(a){a&&U(a,function(a){a&&(e=e.concat(a))})},!0),e}function u(a,b){var c={matchType:Ib.noMatch,magicWordIndex:-1};return U(a,function(a,d){var e=v(a,b);return e>c.matchType&&(c.matchType=e,c.magicWordIndex=d),c.matchType!==Ib.equals}),c}function v(a,b){return a=(""+a).toLowerCase(),b.length>a.length?Ib.noMatch:a===b?Ib.equals:0===a.indexOf(b)?Ib.startsWith:-1!==a.indexOf(" "+b)?Ib.wordStartsWith:-1!==a.indexOf(b)?Ib.contains:1===b.length?Ib.noMatch:-1!==w(a).indexOf(b)?Ib.acronym:x(a,b)}function w(a){var b="",c=a.split(" ");return U(c,function(a){var c=a.split("-");U(c,function(a){b+=a.substr(0,1)})}),b}function x(a,b){function c(a,b){for(var c=!1,e=d;e<b.length;e++){var f=b[e];if(f===a){c=!0,d=e+1;break}}return c}for(var d=0,e=0;e<b.length;e++){var f=b[e],g=c(f,a);if(!g)return Ib.noMatch}return Ib.matches}function y(a,b,c,d){var e=d.indexOf(a.id);b.matchType!==Ib.noMatch?-1===e&&z(c,b).push(a.id):-1!==e&&d.splice(e,1)}function z(a,b){a[b.matchType]=a[b.matchType]||[];var c=a[b.matchType],d=c[b.magicWordIndex]=c[b.magicWordIndex]||[];return d}function A(a,b){return a=B(a,b),C(a)?(D(a,b),fb(b)||H(a,b),a):null}function B(a,b){var c=a;if(bb(c)||(c=l(a)),fb(c)){var d=o(b);d.length>0&&(c=d[0])}return c}function C(a){return a&&!fb(a.action)&&F(a)}function D(a,b){a.action(a,b);var c=a.data.timesMade;c.total++,c.magicWords[b]=c.magicWords[b]||0,c.magicWords[b]++}function E(a){return bb(a)||(a=M(a)),_(a)&&1===a.length?a[0]===Ab[0]:a.any&&1===a.any.length?a.any[0]===Ab[0]:!1}function F(a){return E(Cb)||E(a.context)||a.context===Cb||G(a,Cb)}function G(a,b){var c,d=a.context.any||[],e=a.context.all||[],f=a.context.none||[],g=T(d)||P(b,d),h=b.length>=e.length&&R(b,e),i=Q(b,f);return c=g&&h&&i}function H(a,b){var c=I(zb,b);c.wishes=c.wishes||[];var d=c.wishes.indexOf(a.id);0!==d&&J(a.id,c.wishes,d)}function I(a,b){var c=b.substring(0,1),d=b.substring(1),e=a[c]=a[c]||{};return d?I(e,d):e}function J(a,b,c){if(-1!==c&&b.splice(c,1),1!==c&&b.length>0){var d=b[0];b[0]=a,a=d}b.unshift(a)}function K(a){var b={add:[],remove:[]};return U(Db,function(c){var d=!1,e=c.contexts,f=c.regexes,g=c.paths;U(f,function(c){c.lastIndex=0;var f=c.exec(a);if(f&&f.length>0){var g=[];U(e,function(a){var b=a.replace(Hb,function(a,b){return f[b]});g.push(b)}),b.add=b.add.concat(g),d=!0}return!d}),d||(U(g,function(c){return a===c&&(b.add=b.add.concat(e),d=!0),!d}),d||(b.remove=b.remove.concat(e)))}),b}function L(){var a=[];return U(Db,function(b){var c=b.contexts;U(c,function(b){if(Hb.test(b)){var c=b.replace(Hb,".+?");U(Cb,function(b){new RegExp(c).test(b)&&a.push(b)})}})}),a}function M(a){return a?_(a)?a:[a]:[]}function N(a,b){b=M(b),U(b,function(b){a.indexOf(b)<0&&a.push(b)})}function O(a,b){b=M(b);for(var c=0;c<a.length;)S(b,a[c])?a.splice(c,1):c++}function P(a,b){a=M(a),b=M(b);for(var c=0;c<b.length;c++)if(S(a,b[c]))return!0;return!1}function Q(a,b){a=M(a),b=M(b);for(var c=0;c<b.length;c++)if(S(a,b[c]))return!1;return!0}function R(a,b){a=M(a),b=M(b);for(var c=0;c<b.length;c++)if(!S(a,b[c]))return!1;return!0}function S(a,b){return a.indexOf(b)>-1}function T(a){return fb(a)?!0:_(a)?0===a.length:cb(a)?!1:!1}function U(a,b,c){return cb(a)&&(a=M(a)),_(a)?V(a,b,c):Y(a,b)}function V(a,b,c){return Z(c)?W(a,b):X(a,b)}function W(a,b){for(var c=!0,d=a.length-1;d>=0&&(c=b(a[d],d,a),!$(c));d--);return c}function X(a,b){for(var c=!0,d=0;d<a.length&&(c=b(a[d],d,a),!$(c));d++);return c}function Y(a,b){var c=!0;for(var d in a)if(a.hasOwnProperty(d)&&(c=b(a[d],d,a),$(c)))break;return c}function Z(a){return 1==a}function $(a){return 0==a}function _(a){return a instanceof Array}function ab(a){return"string"==typeof a}function bb(a){return"object"==typeof a}function cb(a){switch(typeof a){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}function db(a){return _(a)?!U(a,function(a){return!db(a)}):"undefined"==typeof a}function eb(a){return _(a)?!U(a,function(a){return!eb(a)}):null===a}function fb(a){return eb(a)||db(a)}function gb(a){return a&&(jb(a),yb=a.previousId||yb,zb=a.enteredMagicWords||zb,Cb=a.context||Cb,Eb=a.previousContext||Eb,Fb=a.enabled||Fb,Gb=a.returnOnDisabled||Gb),{wishes:xb,previousId:yb,enteredMagicWords:zb,context:Cb,previousContext:Eb,enabled:Fb}}function hb(a){wb.getMatchingWishes=vb(function(b){return a(xb,b,Cb,zb)},[])}function ib(){wb.getMatchingWishes=Bb}function jb(a){a.wishes&&(a.noWishMerge?xb=a.wishes:kb(a.wishes))}function kb(a){return U(a,function(a){var b=-1,c=null;U(xb,function(d,e){return d.id===a.id?(c=d,b=e,!1):void 0}),!a.action&&c&&(a.action=c.action),a.action&&(xb[b]=a)}),xb}function lb(a){return void 0!==a&&(Eb=Cb,"string"==typeof a&&(a=[a]),Cb=a),Cb}function mb(a){return Eb=Cb,N(Cb,a),Cb}function nb(a){return Eb=Cb,O(Cb,a),T(lb)&&(Cb=Ab),Cb}function ob(){return lb(Eb)}function pb(){return lb(Ab)}function qb(a,b){if(a){var c=K(a),d=c.add,e=L();e=e.concat(c.remove),nb(e),b||h(e),mb(d)}return Cb}function rb(a){return U(a,function(a){a.paths&&(a.paths=M(a.paths)),a.regexes&&(a.regexes=M(a.regexes)),a.contexts&&(a.contexts=M(a.contexts))}),N(Db,a),Db}function sb(a){return O(Db,a),Db}function tb(a){return void 0!==a&&(Fb=a),Fb}function ub(a){return void 0!==a&&(Gb=a),Gb}function vb(a,b){return function(){return Fb||a===tb?a.apply(this,arguments):Gb?b:null}}var wb=null,xb=[],yb=0,zb={},Ab=["universe"],Bb=function(){},Cb=Ab,Db=[],Eb=Ab,Fb=!0,Gb=!0,Hb=/\{\{(\d+)\}\}/,Ib={equals:5,startsWith:4,wordStartsWith:3,contains:2,acronym:1,matches:0,noMatch:-1};return wb=vb(a,{}),wb.getWishesInContext=vb(i,[]),wb.getWishesWithContext=vb(j,[]),wb.getWish=vb(l,{}),wb.getMatchingWishes=vb(o,[]),wb.overrideMatchingAlgorithm=vb(hb,{}),wb.restoreMatchingAlgorithm=vb(ib,{}),wb.makeWish=vb(A,{}),wb.options=vb(gb,{}),wb.mergeWishes=vb(kb,{}),wb.deregisterWish=vb(f,{}),wb.deregisterWishesWithContext=vb(h,[]),wb.reset=vb(n,{}),wb.context=vb(lb,[]),wb.addContext=vb(mb,[]),wb.removeContext=vb(nb,[]),wb.revertContext=vb(ob,[]),wb.restoreContext=vb(pb,[]),wb.updatePathContext=vb(qb,[]),wb.addPathContext=vb(rb,[]),wb.removePathContext=vb(sb,[]),wb.enabled=vb(tb,!1),wb.returnOnDisabled=vb(ub,!0),Bb=wb.getMatchingWishes,wb});